<!DOCTYPE html>
<html lang="en"     prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml" >

<head>
    <title>How to completely disable Autofac components - Blair Conrad</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blairconrad.com/2011/02/27/how-to-completely-disable-autofac-components/">

        <meta name="author" content="Blair Conrad" />
        <meta name="keywords" content=".NET,Autofac,Development" />
        <meta name="description" content="This week I started working with the Autofac Inversion of Control container at the Day Job. The first project I tried to introduce Autofac to needed a plugin system. I figured this was a perfect use of Autofac&#39;s implicit relationship handlers. Sure enough, a container.Resolve&lt;IEnumerable&lt;IPlugin&gt;&gt;() did the …" />

        <meta property="og:site_name" content="Blair Conrad" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="How to completely disable Autofac components"/>
        <meta property="og:url" content="https://blairconrad.com/2011/02/27/how-to-completely-disable-autofac-components/"/>
        <meta property="og:description" content="This week I started working with the Autofac Inversion of Control container at the Day Job. The first project I tried to introduce Autofac to needed a plugin system. I figured this was a perfect use of Autofac&#39;s implicit relationship handlers. Sure enough, a container.Resolve&lt;IEnumerable&lt;IPlugin&gt;&gt;() did the …"/>
        <meta property="article:published_time" content="2011-02-27" />
            <meta property="article:section" content="Development" />
            <meta property="article:tag" content=".NET" />
            <meta property="article:tag" content="Autofac" />
            <meta property="article:tag" content="Development" />
            <meta property="article:author" content="Blair Conrad" />



    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://blairconrad.com/theme/css/bootstrap.min.css" type="text/css" />

    <link href="https://blairconrad.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blairconrad.com/theme/css/pygments/github.css"
        rel="stylesheet">
    <link href="https://blairconrad.com/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blairconrad.com/theme/css/style.css" type="text/css" />
    <link href="https://blairconrad.com/theme/css/custom.css" rel="stylesheet">

    <link href="https://blairconrad.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
        title="Blair Conrad ATOM Feed" />

    <link href="https://blairconrad.com/feeds/development.atom.xml" type="application/atom+xml" rel="alternate"
        title="Blair Conrad Development ATOM Feed" />
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top"
        role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://blairconrad.com/" class="navbar-brand">
Blair Conrad                </a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/Recipes">Recipes</a></li>
                        <li class="active" >
                            <a href="https://blairconrad.com/category/development.html">Development</a>
                        </li>
                        <li >
                            <a href="https://blairconrad.com/category/miscellany.html">Miscellany</a>
                        </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><span>
                            <form class="navbar-search" action="/search.html">
                                <input type="text" class="search-query" placeholder="Search" name="q"
                                    id="tipue_search_input" required>
                            </form>
                        </span>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
    </div> <!-- /.navbar -->

    <!-- Banner -->
    <!-- End Banner -->

    <!-- Content Container -->
    <div class="container">
        <div class="row">
            <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blairconrad.com/2011/02/27/how-to-completely-disable-autofac-components/"
                       rel="bookmark"
                       title="Permalink to How to completely disable Autofac components">
                        How to completely disable Autofac components
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <!-- <span class="published"> -->
    <i class="fa fa-calendar"></i><time datetime="2011-02-27T00:00:00-05:00"> 2011-02-27</time>
    <!-- </span> -->



    <i class="fa fa-folder"></i>
    <a href="https://blairconrad.com/category/development.html"></i>Development</a>


<i class="fa fa-tags"></i>
<a href="https://blairconrad.com/tag/.net.html">.NET</a>
/
<a href="https://blairconrad.com/tag/autofac.html">Autofac</a>
/
<a href="https://blairconrad.com/tag/development.html">Development</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This week I started working with the <a href="http://code.google.com/p/autofac/">Autofac</a> <a href="http://www.martinfowler.com/articles/injection.html">Inversion of Control container</a> at the Day Job. The first project I tried to introduce Autofac to needed a plugin system. I figured this was a perfect use of <a href="http://nblumhardt.com/2010/01/the-relationship-zoo/">Autofac's implicit relationship handlers</a>. Sure enough, a</p>
<pre><code class="csharp">container.Resolve&lt;IEnumerable&lt;IPlugin&gt;&gt;()</code></pre>

<p>did the trick - I got a nice list of plugin instances for the application to use.</p>
<p>This isn't enough, though. We need to disable certain components via configuration. One option would be to remove the components from the configuration file, but I wanted to make it easy to restore the plugins (and their original configuration) should the need arise. After poring over the Autofac documentation, it seemed like adding an "Enabled" flag in the components' metadata would be the best way to handle toggling them between on and off. </p>
<p>Setting up the config file was straightforward,
<pre><code class="xml">&lt;autofac defaultAssembly="DisableComponents"&gt;
  &lt;components&gt;
    &lt;component type="DisableComponents.Plugin1" service="DisableComponents.IPlugin"&gt;
      &lt;metadata&gt;
        &lt;item name="Enabled" value="false" type="System.Boolean" /&gt;
      &lt;/metadata&gt;
    &lt;/component&gt;
    &lt;component type="DisableComponents.Plugin2" service="DisableComponents.IPlugin"&gt;
      &lt;metadata&gt;
        &lt;item name="Enabled" value="true" type="System.Boolean" /&gt;
      &lt;/metadata&gt;
    &lt;/component&gt;
  &lt;/components&gt;
&lt;/autofac&gt;</code></pre></p>
<p>as was filtering the components list.</p>
<pre><code class="csharp">var enabledComponents = container.Resolve&lt;IEnumerable&lt;Meta&lt;IPlugin&gt;&gt;&gt;()
    .Where(ComponentIsEnabled)
    .Select(c=&gt;c.Value);

...

private static bool ComponentIsEnabled&lt;T&gt;(Meta&lt;T&gt; component)
{
    const string enabled = "Enabled";
    return !component.Metadata.ContainsKey(enabled) || (bool)component.Metadata[enabled];
}</code></pre>

<h2>They're still created, though</h2>

<p>This approach worked, but all all components are instantiated, including the disabled ones which are made just so we can throw them away. This seems a little wasteful. Worse, a particular installation may have a plugin disabled because it can't (or doesn't want to) support its creation. So I sought a way to prevent the instantiation of the unwanted plugins.</p>
<p>I tried to find a way to remove or disallow registration based on the metadata, or to intercept component creation, but came up short. The best I could come up with was a modification to the approach above:
<pre><code class="csharp">var enabledComponents = container.Resolve&lt;IEnumerable&lt;Meta&lt;Func&lt;IPlugin&gt;&gt;&gt;&gt;()
    .Where(ComponentIsEnabled)
    .Select(c=&gt;c.Value());</code></pre></p>
<p>(I would have preferred to use a <a href="http://msdn.microsoft.com/en-us/library/dd642331.aspx">Lazy</a> over a <a href="http://msdn.microsoft.com/en-us/library/bb534960.aspx">Func</a>, but I'm working with .Net&nbsp;35.)</p>
<p>This works&mdash;the plugins are only created when they're enabled&mdash;but it feels inelegant.
I can't help but think that my Autofac knowledge is too shallow to have discovered the "right" way to do this. Hopefully deeper understanding will come in time&hellip;</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

            </div>
            <div class="col-sm-3" id="sidebar">
                <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="http://github.com/blairconrad"><i class="fa fa-github-square fa-lg"></i> Github</a></li>
    <li class="list-group-item"><a href="http://twitter.com/hippopottoman"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
    <li class="list-group-item"><a href="https://www.goodreads.com/user/show/1066544-blair-conrad"><i class="fa fa-goodreads-square fa-lg"></i> Goodreads</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->
  </ul>
</section>
<!-- End Sidebar -->                </aside>
            </div>
        </div>
    </div>
    <!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Blair Conrad
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
    <script src="https://blairconrad.com/theme/js/jquery.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://blairconrad.com/theme/js/bootstrap.min.js"></script>

    <!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
    <script src="https://blairconrad.com/theme/js/respond.min.js"></script>




</body>

</html>