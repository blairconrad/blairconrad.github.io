<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Select May Not be Broken, But it's Bent - Blair Conrad</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blairconrad.com/2015/10/05/select-may-not-be-broken-but-its-bent/">

        <meta name="author" content="Blair Conrad" />
        <meta name="keywords" content=".NET" />
        <meta name="description" content="Earlier this week at the day job I ran into an interesting problem working with a DataTable. A view that&#39;s supposed to show a subset of the table&#39;s rows showed nothing. I dropped into the debugger and became even more confused. Visually inspecting the DataTable showed that there was a …" />

        <meta property="og:site_name" content="Blair Conrad" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Select May Not be Broken, But it&#39;s Bent"/>
        <meta property="og:url" content="https://blairconrad.com/2015/10/05/select-may-not-be-broken-but-its-bent/"/>
        <meta property="og:description" content="Earlier this week at the day job I ran into an interesting problem working with a DataTable. A view that&#39;s supposed to show a subset of the table&#39;s rows showed nothing. I dropped into the debugger and became even more confused. Visually inspecting the DataTable showed that there was a …"/>
        <meta property="article:published_time" content="2015-10-05" />
            <meta property="article:section" content="Development" />
            <meta property="article:tag" content=".NET" />
            <meta property="article:author" content="Blair Conrad" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blairconrad.com/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blairconrad.com/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blairconrad.com/theme/css/pygments/github.css" rel="stylesheet">
    <link href="https://blairconrad.com/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blairconrad.com/theme/css/style.css" type="text/css"/>
        <link href="https://blairconrad.com/theme/css/custom.css" rel="stylesheet">

        <link href="https://blairconrad.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blair Conrad ATOM Feed"/>

        <link href="https://blairconrad.com/feeds/development.atom.xml" type="application/atom+xml" rel="alternate"
              title="Blair Conrad Development ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blairconrad.com/" class="navbar-brand">
Blair Conrad            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/Recipes">Recipes</a></li>
                        <li class="active">
                            <a href="https://blairconrad.com/category/development.html">Development</a>
                        </li>
                        <li >
                            <a href="https://blairconrad.com/category/miscellany.html">Miscellany</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blairconrad.com/2015/10/05/select-may-not-be-broken-but-its-bent/"
                       rel="bookmark"
                       title="Permalink to Select May Not be Broken, But it's Bent">
                        Select May Not be Broken, But it's Bent
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span><i class="fa fa-calendar"></i><time datetime="2015-10-05T00:00:00-04:00">2015-10-05</time></span>
    <span><i class="fa fa-folder"></i><a href="https://blairconrad.com/category/development.html"></i>Development</a></span>


<span><i class="fa fa-tags"></i>
<a href="https://blairconrad.com/tag/.net.html">.NET</a>
</span>
    

</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Earlier this week at the day job I ran into an interesting problem
working with a <a href="https://msdn.microsoft.com/en-us/library/system.data.datatable(v=vs.100).aspx">DataTable</a>.  A view that's supposed to show
a subset of the table's rows showed nothing. I dropped into the
debugger and became even more confused.</p>
<p>Visually inspecting the DataTable showed that there was a row that
matched the filter the view was using, but running <code>Select</code> still
returned nothing. I didn't bring work's code home, but here's some
code that reproduces the problem:</p>
<pre><code class="csharp">Console.Out.WriteLine("0th book's Library:\t{0}", books[0].Library);
Console.Out.WriteLine("# WPL books by Select:\t{0}", library.Books.Select("Library = 'WPL'").Length);
Console.Out.WriteLine("# WPL books by LINQ:\t{0}", library.Books.Count(book => book.Library == "WPL"));</code></pre>

<p>And the output:</p>
<pre>0th book's Library:     WPL
# WPL books by Select:  0
# WPL books by LINQ:    1</pre>

<p>So, the table contains at least one book from <a href="http://www.wpl.ca">WPL</a>, <code>Select</code>ing
for that library doesn't find the book, yet iterating over all the
rows and <code>Count</code>ing them does find it.</p>
<p>Just in case you think there's some whitespace trickery going on or
something, debug with me:</p>
<figure>
  <img src="https://blairconrad.com/images/2015-10-05-select-may-not-be-broken/debugging.png">
</figure>

<p>How is this happening? The row's Library property is actually
<code>DBNull</code>, but the dataset defines both <code>DefaultValue</code> and <code>NullValue</code>:</p>
<figure>
  <img src="https://blairconrad.com/images/2015-10-05-select-may-not-be-broken/library_properties.png">
</figure>

<p>So even though there was <code>DBNull</code> in the row, whenever I examined the
<code>Library</code> property, via code (such as the LINQ statements) or
visually in the debugger, it appeared to be "WPL".</p>
<p><code>Select</code>, however, wasn't fooled. It knew the value was <code>DBNull</code> and
wouldn't match.</p>
<p>I'm of two minds about this. It's arguably <em>correct</em> behaviour, as the
stored value is not "WPL", but I'm not sure that it's desirable to be
able to configure the table to present data in a way that's not
supported by the query.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2017 Blair Conrad
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blairconrad.com/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blairconrad.com/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blairconrad.com/theme/js/respond.min.js"></script>




</body>
</html>